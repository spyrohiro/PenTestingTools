#!/bin/bash

# Define variables
LIGOLO_DIR="/opt/ligolo"
AGENT_URL="https://github.com/nicocha30/ligolo-ng/releases/download/v0.4.4/ligolo-ng_agent_0.4.4_linux_amd64.tar.gz"
PROXY_URL="https://github.com/nicocha30/ligolo-ng/releases/download/v0.4.4/ligolo-ng_proxy_0.4.4_linux_amd64.tar.gz"
WIN_AGENT="https://github.com/nicocha30/ligolo-ng/releases/download/v0.4.4/ligolo-ng_agent_0.4.4_windows_amd64.zip"

# Create ligolo directory
sudo mkdir -p $LIGOLO_DIR
cd $LIGOLO_DIR

# Download the files
echo "Downloading Ligolo agent (for victim's machine)..."
sudo wget $AGENT_URL

echo "Downloading Ligolo proxy (for attacker's machine)..."
sudo wget $PROXY_URL

echo "Downloading Ligolo proxy (for attacker's machine)..."
sudo wget $WIN_AGENT

# Extract the downloaded files
echo "Extracting Ligolo agent..."
sudo tar -xvf $(basename $AGENT_URL)

echo "Extracting Ligolo proxy..."
sudo tar -xvf $(basename $PROXY_URL)

echo "Extracting Ligolo agent..."
sudo unzip $(basename $WIN_AGENT)

# Set up the network interface on the attacker's machine
echo "Setting up TUN interface..."
YOUR_USERNAME=$(whoami)
sudo ip tuntap add user $YOUR_USERNAME mode tun ligolo
sudo ip link set ligolo up

# Move to Ligolo directory

cd /opt/ligolo

# Run the Ligolo proxy
echo "Starting Ligolo proxy on port 443..."
sudo ./proxy -selfcert

echo "Ligolo setup is complete!"
